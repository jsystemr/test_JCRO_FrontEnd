
<html>
<head>
<meta charset="ISO-8859-1">
<title>Front End Utilizando Jquery y Bootstrap</title>
<link rel="shortcut icon" href="#">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
<link href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet">
<script
  src="https://code.jquery.com/jquery-3.4.1.js"
  integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU="
  crossorigin="anonymous"></script>
<script type="text/javascript">
const ulrServer="http://localhost:8080/";

   var nom="";
   var monto="";
   var fecha="";

cargarDatos();
//Oculta el Boton Actulizar del Formulario
document.getElementById("btnupd").hidden=true;

function cargarDatos(){
  console.log('Entro a cargar datos');
      fetch(ulrServer+"tablamemoria", {
      method: 'GET', // or 'PUT'
      //body: JSON.stringify(data), // data can be `string` or {object}!
      headers:{
        'Content-Type': 'application/json'
      }
    }).then(res => res.json())
    .catch(error => console.error('Error:', error))
    .then(function(data){
      $('#detalle').html("");
        for(let v of data.values()){
            console.log(v);
            addfilaTabla(v);
            }
    });
}
  
function addfilaTabla(ob){
          let id=ob.id;
          let nombre=ob.nombre;
          let monto=ob.monto_deducir;
          let fecha=ob.Fecha_cambio;
					$('#detalle').append("<tr id="+id+"><td>"+id+"</td>"
							+"<td>"+nombre+"</td>"
							+"<td>"+monto+"</td>"
							+"<td>"+fecha+"</td>"
              +"<td><button id='btn"+id+"' class='btn btn-danger mb-3 btndel' onclick='verbtndel("+id+")'> Delete</button><span> </span>"
              +"<button id='btned"+id+"' class='btn btn-success mb-3 btnedit' onclick='verdatosform("+id+")' "
              +" data-bs-toggle='modal' data-bs-target='#exampleModal'> Actualizar</button> </td></tr>");
				}

function verbtndel(parm){
  var delreg=false;
  if(confirm('Esta seguro de quitar el registro?')){
    console.log('Elemento a Eliminar->'+parm);
    fetch(ulrServer+'tablamemoria/'+parm, {
        method: 'DELETE',
        body: {id:parm}
      })
      .then(response => response.json())
      .catch(error => console.error('Error:', error))
      .then(response => {
             cargarDatos();
      });
      }
  }


</script>
</head>
<body>
  <div class="row">
    <div class="col">
      <div class="card">
        <div class="card-header">
          Prueba Practica Zamorano 29-05-2021
        </div>
        <ul class="nav justify-content-center">
          <li class="nav-item">
            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">
              Agregar
            </button>
          </li>
        </ul>
        <div class="card-body">
          <h5 class="card-title">Listado de Datos</h5>
          <div class="table-responsive">
            <table class="table table-strip table-hover table-bordered ">
            <thead>
            <th>ID</th><th>Nombre</th><th>Monto Deducir</th><th>Fecha Cambio</th><th>Accion</th>
            </thead>
            <tbody id="detalle">
            <tr><td></td><td></td><td></td><td></td><td></td></tr>
            </tbody>
            </table>
        </div>
      </div>
      </div>
    </div>
  </div> 
  <!--
    Area del Modal para Enviar Informaicion
  -->

   <!-- Modal -->
   <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Ingrese la Informaci&oacute;n Solicitada</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form action="#" id="frmdatos">
            <div class="mb-3">
              <label for="nombre" class="form-label">Nombre</label>
              <input type="hidden" class="form-control" id="txtid" value="0" >
              <input type="text" class="form-control" id="txtnom" placeholder="Jhon Doe" required>
            </div>
            <div class="mb-3">
              <label for="monto" class="form-label">Monto a deducir</label>
              <input type="number" class="form-control" step="0.01" id="txtmonto" placeholder="99.00" required>
            </div>
            <div class="mb-3">
              <label for="fecha" class="form-label">Fecha Cambio</label>
              <input type="date" class="form-control" id="txtfecha" placeholder="27/09/2021" required>
            </div>
            <button type="button" id="btnsave" class="btn btn-success mb-3">Enviar</button>
            <button type="button" id="btnupd" class="btn btn-success mb-3">Actualizar</button>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
</div>
<script type="text/javascript">
//------------Accion para Guardar los Datos-->
 document.getElementById("btnsave").addEventListener('click',()=>{

   getValoresform();
   var paso=true;
   var resdata=false;
   if(nom.value==""){paso=false;}
   if(monto.value==""){paso=false;}
   if(fecha.value==""){paso=false;}
      if(paso)
        {
          var tablamemoria= {id:0,nombre:nom,monto_deducir:monto,fecha_cambio:fecha};
          console.log(JSON.stringify(tablamemoria));
         fetch(ulrServer+'tablamemoria/new', {
            method: 'POST',
            body: JSON.stringify(tablamemoria), 
            headers:{
              'Content-Type': 'application/json'
            }
          })
          .then(response => response.json())
          .catch(error => console.error('Error:', error))
          .then(response =>{
            alert('Registro agregado exitosamente!');
            nom.value="";monto.value=0.0;
            cargarDatos();
          });
           
        }else{
          alert('Debe ingresar informacion!');
        }
    });
    //------------Accion Editar----------------------------------------------------------->
    function verdatosform(parm){
      if(parm!=0){
        document.getElementById("btnupd").hidden=false;
        document.getElementById("btnsave").hidden=true;
        console.log('Elemento a editar->'+parm);
        fetch(ulrServer+'tablamemoria/'+parm)
          .then(response => response.json())
          .catch(error => console.error('Error:', error))
          .then(response => {
            console.log(response.nombre,response.monto_deducir,response.Fecha_cambio);
            document.getElementById("txtid").value=response.id;
            document.getElementById("txtnom").value=response.nombre;
            document.getElementById("txtmonto").value=response.monto_deducir;
            document.getElementById("txtfecha").value=response.Fecha_cambio;
          });
      }
  }

  document.getElementById("btnupd").addEventListener('click',()=>{
      getValoresform();
      var paso=true;
      var resdata=false;
      if(nom.value==""){paso=false;}
      if(monto.value==""){paso=false;}
      if(fecha.value==""){paso=false;}
          if(paso)
            {
              var parmid= document.getElementById("txtid").value;
              var tablamemoria= {id:parmid,nombre:nom,monto_deducir:monto,fecha_cambio:fecha};
              console.log(JSON.stringify(tablamemoria));
              
            fetch(ulrServer+'tablamemoria/'+parmid, {
                method: 'PUT',
                body: JSON.stringify(tablamemoria), 
                headers:{
                  'Content-Type': 'application/json'
                }
              })
              .then(response => response.json())
              .catch(error => console.error('Error:', error))
              .then(response =>{
                alert('Registro agregado exitosamente!');
                nom.value="";monto.value=0.0;
                cargarDatos();
              });
              
            }else{
              alert('Debe ingresar informacion!');
            }
      });


      function getValoresform(){
      nom=document.getElementById("txtnom").value;
      monto=parseFloat(document.getElementById("txtmonto").value);
      fecha=document.getElementById("txtfecha").value;
    }
  </script>
</body>
</html>